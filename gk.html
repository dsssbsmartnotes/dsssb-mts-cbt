<!DOCTYPE html>
<html>
<head>
<title>DSSSB MTS GK CBT</title>
<style>
body{font-family:arial;background:#f2f2f2;margin:0}
header{background:#0b2c4d;color:#fff;padding:15px;font-size:22px}
#box{display:flex}
#left{width:75%;padding:20px;background:#fff}
#right{position:fixed;top:55px;right:0;width:220px;background:#e9ecef;padding:10px;height:calc(100vh - 55px);overflow-y:auto;}
.qbtn{width:40px;height:40px;margin:5px;border:none;background:#ccc;cursor:pointer}
.attempted{background:#4caf50;color:white}
.review{background:orange;color:black}
.hidden{display:none}
button{padding:10px 15px;margin:10px}
</style>
</head>
<body>

<div id="loginBox">
<h2>DSSSB MTS ‚Äì Candidate Login</h2>
<input id="cname" placeholder="Enter Name"><br><br>
<input id="croll" placeholder="Enter Roll"><br><br>
<button onclick="startTest()">Start Test</button>
</div>

<header id="topbar" style="display:none">
DSSSB MTS GK CBT <span id="timer" style="float:right">30:00</span>
</header>

<div id="box" style="display:none">
<div id="left">
<h3 id="q"></h3>
<div id="opt"></div>
<button onclick="prev()">Prev</button>
<button onclick="next()">Next</button>
<button onclick="submit()">Submit</button>
</div>
<div id="right"></div>
</div>

<div id="scoreCard" style="display:none">
<h2>RESULT</h2>
<p>Name: <b id="sname"></b></p>
<p>Roll: <b id="sroll"></b></p>
<p>Score: <b id="scr"></b></p>

<h3>üèÜ All India Rank</h3>
<table border="1" id="rankTable"></table>
</div>

<!-- üî• FIREBASE ENGINE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection, query, orderBy } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCnz5Jnxka9hOEPCtBVFfN8Zq4UrqS9Ots",
  authDomain: "dsssb-all-india-rank.firebaseapp.com",
  projectId: "dsssb-all-india-rank",
  storageBucket: "dsssb-all-india-rank.firebasestorage.app",
  messagingSenderId: "1073765640120",
  appId: "1:1073765640120:web:0334d6a3281383e8c0514d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db; window.doc=doc; window.setDoc=setDoc;
window.getDocs=getDocs; window.collection=collection;
window.query=query; window.orderBy=orderBy;
</script>

<script>
let qdata=[
["Sundari trees are found in?","Mangrove","Coniferous","Deciduous","None",0],
["Reservation is under which Article?","14","15(4)","16","21",1]
];

let i=0,ans=[],t=1800;

function startTest(){
 localStorage.cname=cname.value;
 localStorage.croll=croll.value;
 loginBox.style.display="none";
 topbar.style.display="block";
 box.style.display="flex";
 load();
}

function load(){
 let q=qdata[i];
 qEl.innerText=q[0];
 let o="";
 for(let k=1;k<=4;k++){
  o+=`<label><input type="radio" onclick="ans[${i}]=${k-1}"> ${q[k]}</label><br>`;
 }
 opt.innerHTML=o;
}

function next(){i++;load();}
function prev(){i--;load();}

async function submit(){
 let correct=0;
 for(let j=0;j<qdata.length;j++) if(ans[j]==qdata[j][5]) correct++;

 await setDoc(doc(db,"mts_gk_test1",localStorage.croll),{
  name:localStorage.cname,
  score:correct,
  date:new Date()
 });

 let q=query(collection(db,"mts_gk_test1"),orderBy("score","desc"));
 let snap=await getDocs(q);

 let rt="<tr><th>Rank</th><th>Name</th><th>Roll</th><th>Score</th></tr>";
 let r=1;
 snap.forEach(d=>{
  let x=d.data();
  rt+=`<tr><td>${r++}</td><td>${x.name}</td><td>${d.id}</td><td>${x.score}</td></tr>`;
 });

 rankTable.innerHTML=rt;
 box.style.display="none";
 scoreCard.style.display="block";
 sname.innerText=localStorage.cname;
 sroll.innerText=localStorage.croll;
 scr.innerText=correct;
}
</script>
</body>
</html>
